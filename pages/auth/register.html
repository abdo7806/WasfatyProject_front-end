<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>إنشاء حساب - نظام وصفتي</title>
    <!-- Google Font: Tajawal -->
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700&display=swap" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="../../plugins/fontawesome-free/css/all.min.css">
    <!-- SweetAlert2 -->
    <link rel="stylesheet" href="../../plugins/sweetalert2/sweetalert2.min.css">
    <!-- Theme style -->
    <link rel="stylesheet" href="../../dist/css/adminlte.min.css">
    <!-- Custom CSS -->
    <style>
    :root {
        --primary-color: #3498db;
        --secondary-color: #2980b9;
        --error-color: #e74c3c;
        --success-color: #2ecc71;
    }
    
    body {
        font-family: 'Tajawal', sans-serif;
        background: linear-gradient(135deg, #f5f7fa 0%, #e4e8eb 100%);
        height: 100vh;
        display: flex;
        justify-content: center;
        align-items: center;
    }
    
    .register-container {
        width: 100%;
        max-width: 500px;
        animation: fadeIn 0.6s ease-in-out;
    }
    
    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(20px); }
        to { opacity: 1; transform: translateY(0); }
    }
    
    .register-logo {
        text-align: center;
        margin-bottom: 1.5rem;
    }
    
    .register-logo a {
        font-size: 2.2rem;
        font-weight: 700;
        color: var(--primary-color);
        text-decoration: none;
    }
    
    .card {
        border: none;
        border-radius: 12px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        overflow: hidden;
    }
    
    .card-header {
        background-color: var(--primary-color);
        color: white;
        padding: 1.5rem;
        text-align: center;
        border-bottom: none;
    }
    
    .card-body {
        padding: 2rem;
    }
    
    .register-title {
        font-size: 1.5rem;
        font-weight: 600;
        color: #2c3e50;
        margin-bottom: 1.5rem;
        text-align: right;
    }
    
    .input-group {
        margin-bottom: 1.2rem;
        direction: ltr;
    }
    
    .input-group-text {
        background-color: #f8f9fa;
        border-right: none;
        border-left: 1px solid #ced4da;
    }
    
    .form-control {
        border-left: none;
        border-right: 1px solid #ced4da;
        padding: 0.75rem 1rem;
        height: calc(2.25rem + 8px);
        text-align: right;
    }
    
    .form-control:focus {
        box-shadow: 0 0 0 0.2rem rgba(52, 152, 219, 0.25);
        border-color: var(--primary-color);
    }
    
    .btn-register {
        background-color: var(--primary-color);
        border-color: var(--primary-color);
        padding: 0.75rem;
        font-weight: 600;
        font-size: 1rem;
        transition: all 0.3s ease;
        width: 100%;
        border-radius: 8px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }
    
    .btn-register:hover {
        background-color: var(--secondary-color);
        border-color: var(--secondary-color);
        transform: translateY(-2px);
    }
    
    .error-message {
        color: var(--error-color);
        font-size: 0.85rem;
        margin-top: -0.5rem;
        margin-bottom: 0.5rem;
        text-align: right;
        display: none;
    }
    
    .terms-check {
        text-align: right;
        margin: 1rem 0;
    }
    
    .login-link {
        display: block;
        text-align: center;
        margin-top: 1.5rem;
        color: var(--primary-color);
        font-weight: 500;
    }
    
    /* Responsive adjustments */
    @media (max-width: 576px) {
        .card-body {
            padding: 1.5rem;
        }
    }
    </style>
</head>

<body>
    <div class="register-container">
        <div class="register-logo">
            <a href="../../index2.html"><b>نظام وصفتي</b></a>
        </div>
        
        <div class="card">
            <div class="card-header">
                <h3 class="text-white mb-0">إنشاء حساب جديد</h3>
            </div>
            
            <div class="card-body">
                <h4 class="register-title">املأ النموذج للتسجيل</h4>

                <div id="success-message" class="alert alert-success d-none"></div>
                <div id="error-message" class="alert alert-danger d-none"></div>

                <div class="form-group">
                    <div id="fullNameError" class="error-message"></div>
                    <div class="input-group">
                        <input type="text" id="fullName" class="form-control" placeholder="الاسم الكامل" required>
                        <div class="input-group-append">
                            <div class="input-group-text">
                                <span class="fas fa-user"></span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <div id="emailError" class="error-message"></div>
                    <div class="input-group">
                        <input type="email" id="email" class="form-control" placeholder="البريد الإلكتروني" required>
                        <div class="input-group-append">
                            <div class="input-group-text">
                                <span class="fas fa-envelope"></span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <div id="passwordError" class="error-message"></div>
                    <div class="input-group">
                        <input type="password" id="password" class="form-control" placeholder="كلمة المرور" required>
                        <div class="input-group-append">
                            <div class="input-group-text">
                                <span class="fas fa-lock"></span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <div id="confirmPasswordError" class="error-message"></div>
                    <div class="input-group">
                        <input type="password" id="confirmPassword" class="form-control" placeholder="تأكيد كلمة المرور" required>
                        <div class="input-group-append">
                            <div class="input-group-text">
                                <span class="fas fa-lock"></span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="terms-check">
                    <div class="icheck-primary">
                        <input type="checkbox" id="agreeTerms" name="terms" required>
                        <label for="agreeTerms">أوافق على <a href="#" class="text-primary">الشروط والأحكام</a> و<a href="#" class="text-primary">سياسة الخصوصية</a></label>
                    </div>
                    <div id="termsError" class="error-message"></div>
                </div>

                <button type="button" id="registerBtn" class="btn btn-register" onclick="handleRegister()">
                    <i class="fas fa-user-plus ml-2"></i> إنشاء حساب
                </button>

                <a href="login.html" class="login-link">لديك حساب بالفعل؟ سجل الدخول</a>
            </div>
        </div>
    </div>

    <!-- jQuery -->
    <script src="../../plugins/jquery/jquery.min.js"></script>
    <!-- Bootstrap 4 -->
    <script src="../../plugins/bootstrap/js/bootstrap.bundle.min.js"></script>
    <!-- SweetAlert2 -->
    <script src="../../plugins/sweetalert2/sweetalert2.min.js"></script>
    <!-- AdminLTE App -->
    <script src="../../dist/js/adminlte.min.js"></script>
            <script src="../js/auth.js"></script>

    <script>
    /**
     * معالجة عملية التسجيل
     */
    async function handleRegister() {
        const fullName = document.getElementById('fullName').value.trim();
        const email = document.getElementById('email').value.trim();
        const password = document.getElementById('password').value;
        const confirmPassword = document.getElementById('confirmPassword').value;
        const agreeTerms = document.getElementById('agreeTerms').checked;
        const registerBtn = document.getElementById('registerBtn');
        
        try {
            // إخفاء رسائل الخطأ السابقة
            hideAllErrors();
            
            // التحقق من صحة البيانات
            const errors = validateRegistration({
                fullName, email, password, confirmPassword, agreeTerms
            });
            
            if (Object.keys(errors).length > 0) {
                displayErrors(errors);
                return;
            }
            
            // عرض حالة التحميل
            registerBtn.innerHTML = '<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> جاري إنشاء الحساب...';
            registerBtn.disabled = true;
            
            // إرسال طلب التسجيل
            const response = await fetch('https://localhost:7219/api/Auth/register', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Accept': 'application/json'
                },
                body: JSON.stringify({
                    fullName,
                    email,
                    password,
                    confirmPassword,
                    role: 3 // دور افتراضي (يمكن تعديله حسب الحاجة)
                }),
                credentials: 'same-origin'
            });
            
            // معالجة الاستجابة
            if (!response.ok) {
                const errorData = await response.json().catch(() => ({}));
                const errorMessage = errorData.message || 'فشل في عملية التسجيل';
                throw new Error(errorMessage);
            }

            const data = await response.json();
            
            // عرض رسالة النجاح
            showSuccess('تم إنشاء الحساب بنجاح! سيتم توجيهك لصفحة تسجيل الدخول...');
            
            // التوجيه بعد 3 ثواني
            setTimeout(() => {
                window.location.href = 'login.html';
            }, 3000);
            
        } catch (error) {
            showError(error.message);
            console.error('Registration error:', error);
            logError('Registration', error);
            
        } finally {
            // إعادة تعيين زر التسجيل
            resetRegisterButton(registerBtn);
        }
    }
    
    /**
     * التحقق من صحة بيانات التسجيل
     */
    function validateRegistration(data) {
        const errors = {};
        
        if (!data.fullName) errors.fullName = 'الاسم الكامل مطلوب';
        if (!data.email) {
            errors.email = 'البريد الإلكتروني مطلوب';
        } else if (!validateEmail(data.email)) {
            errors.email = 'صيغة البريد الإلكتروني غير صالحة';
        }
        if (!data.password) {
            errors.password = 'كلمة المرور مطلوبة';
        } else if (data.password.length < 6) {
            errors.password = 'يجب أن تحتوي كلمة المرور على الأقل 6 أحرف';
        }
        if (data.password !== data.confirmPassword) {
            errors.confirmPassword = 'كلمات المرور غير متطابقة';
        }
        if (!data.agreeTerms) {
            errors.terms = 'يجب الموافقة على الشروط والأحكام';
        }
        
        return errors;
    }
    
    /**
     * عرض رسائل الخطأ
     */
    function displayErrors(errors) {
        for (const [field, message] of Object.entries(errors)) {
            const errorElement = document.getElementById(`${field}Error`);
            if (errorElement) {
                errorElement.textContent = message;
                errorElement.style.display = 'block';
            }
        }
    }
    
    /**
     * إخفاء جميع رسائل الخطأ
     */
    function hideAllErrors() {
        document.querySelectorAll('.error-message').forEach(el => {
            el.style.display = 'none';
        });
        hideError();
    }
    
    /**
     * عرض رسالة نجاح
     */
    function showSuccess(message) {
        const successElement = document.getElementById('success-message');
        if (successElement) {
            successElement.textContent = message;
            successElement.classList.remove('d-none');
        }
    }
    
    /**
     * عرض رسالة خطأ عامة
     */
    function showError(message) {
        const errorElement = document.getElementById('error-message');
        if (errorElement) {
            errorElement.textContent = message;
            errorElement.classList.remove('d-none');
        }
    }
    
    /**
     * إخفاء رسالة الخطأ العامة
     */
    function hideError() {
        const errorElement = document.getElementById('error-message');
        if (errorElement) {
            errorElement.classList.add('d-none');
        }
    }
    
    /**
     * إعادة تعيين زر التسجيل
     */
    function resetRegisterButton(btn) {
        if (btn) {
            btn.innerHTML = '<i class="fas fa-user-plus ml-2"></i> إنشاء حساب';
            btn.disabled = false;
        }
    }
    
    // السماح بالتسجيل عند الضغط على Enter
    document.addEventListener('DOMContentLoaded', () => {
        document.getElementById('confirmPassword').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                handleRegister();
            }
        });
    });
    </script>
</body>

</html>